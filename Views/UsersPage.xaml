<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:StockApp.Models"
             xmlns:conv="clr-namespace:StockApp.Converters"
             x:Class="StockApp.Views.UsersPage"
             Title="ðŸ‘¥ Gestion des utilisateurs"
             BackgroundColor="#F7F8FA">
    <ScrollView>
    <VerticalStackLayout Padding="15" Spacing="15">

        <!-- Bouton Ajouter -->
        <Button Text="âž• Ajouter un utilisateur"
                x:Name="AddButton"
                BackgroundColor="#0078D7"
                TextColor="White"
                FontAttributes="Bold"
                CornerRadius="10"
                HeightRequest="50"
                Clicked="OnAddButtonClicked" />

        <!-- Barre de recherche -->
        <SearchBar x:Name="UserSearchBar"
                   Placeholder="Rechercher un utilisateur..."
                   PlaceholderColor="#888"
                   FontSize="16"
                   HeightRequest="50"
                   TextChanged="OnSearchBarTextChanged"
                   BackgroundColor="White"
                   TextColor="Black"
                   Margin="0,5,0,0" />

        <!-- Formulaire dâ€™ajout utilisateur -->
        <Border x:Name="AddUserForm"
               IsVisible="False"
               BackgroundColor="White"
               Padding="15"
               Margin="0,10,0,10">

            <VerticalStackLayout Spacing="10">
                <Label Text="Ajouter un utilisateur"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#222"
                       HorizontalOptions="Center" />

                <!-- Nom d'utilisateur -->
                <Border BackgroundColor="#F2F2F2" Padding="10">
                    <Entry x:Name="UsernameEntry"
                           Placeholder="Nom d'utilisateur"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- Mot de passe -->
                <Border BackgroundColor="#F2F2F2" Padding="10" >
                    <Entry x:Name="PasswordEntry"
                           Placeholder="Mot de passe"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           IsPassword="True"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- Admin switch -->
                <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                    <Label Text="Admin ?"
                           FontSize="14"
                           TextColor="#222"
                           VerticalOptions="Center"/>
                    <Switch x:Name="IsAdminSwitch"/>
                </HorizontalStackLayout>

                <!-- Boutons -->
                <HorizontalStackLayout HorizontalOptions="Center" Spacing="15">
                    <Button Text="ðŸ’¾ Enregistrer"
                            BackgroundColor="#0078D7"
                            TextColor="White"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="45"
                            Clicked="OnSaveUserClicked" />
                    <Button Text="âŒ Annuler"
                            BackgroundColor="#AAAAAA"
                            TextColor="White"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="45"
                            Clicked="OnCancelUserClicked" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Liste des utilisateurs -->
        <CollectionView x:Name="UserCollectionView"
                        ItemsSource="{Binding ExampleUsers}"
                        Margin="0,10,0,0"
                        SelectionMode="Single"
                        SelectionChanged="TODO">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:User">
                    <Border BackgroundColor="White"
                           Padding="15">

                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                            <!-- Nom d'utilisateur -->
                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Username}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#222" />

                            <!-- Type d'utilisateur -->
                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="{Binding IsAdmin, Converter={StaticResource BooleanToTextConverter}, ConverterParameter='Admin;Standard'}"
                                   FontSize="16"
                                   TextColor="#0078D7" />

                            <!-- Bouton Supprimer -->
                            <Button Grid.Row="0" Grid.Column="1"
                                    Text="âŒ Supprimer"
                                    BackgroundColor="#960018"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="8"
                                    HeightRequest="40"
                                    Clicked="OnDeleteUserClicked"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
    </ScrollView>
</ContentPage>
