<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="StockApp.Views.StockPage"
             xmlns:models="clr-namespace:StockApp.Models"
             Title="StockPage">

    <VerticalStackLayout Padding="10" Spacing="10">

        <!-- Bouton Ajouter -->
        <Button Text="Ajouter"
                x:Name="AddButton"
                HorizontalOptions="Start"
                Clicked="OnAddButtonClicked" />

        <SearchBar x:Name="ProductSearchBar"
           Placeholder="Rechercher un produit"
           HorizontalOptions="FillAndExpand"
           FontSize="16"
           HeightRequest="50"
           TextChanged="OnSearchBarTextChanged" />

        <!-- Ligne des filtres -->
        <HorizontalStackLayout Spacing="10" HorizontalOptions="FillAndExpand">

            <!-- Picker gauche -->
            <Picker x:Name="LeftPicker"
                Title="Filtrer gauche"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand"
                FontSize="16" />

            <!-- Picker origine -->
            <Picker x:Name="OriginPicker"
                    Title="Origine"
                    HorizontalOptions="FillAndExpand"
                    FontSize="16"
                    ItemsSource="{Binding Origins}"
                    SelectedIndexChanged="OriginPicker_SelectedIndexChanged" />
        </HorizontalStackLayout>
        <!-- Formulaire d’ajout de produit -->
        <Frame x:Name="AddProductForm"
               IsVisible="False"
               BackgroundColor="#EFEFEF"
               BorderColor="LightGray"
               CornerRadius="8"
               Padding="15"
               Margin="0,5,0,10">

            <VerticalStackLayout Spacing="10">
                <Label Text="Ajouter un produit"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="Black"
                       HorizontalOptions="Center" />

                <Entry x:Name="NameEntry"
                       Placeholder="Nom du produit"
                       PlaceholderColor="#555"
                       TextColor="Black" />

                <Entry x:Name="QuantityEntry"
                       Placeholder="Quantité"
                       PlaceholderColor="#555"
                       TextColor="Black"
                       Keyboard="Numeric" />

                <Entry x:Name="ColorEntry"
                       Placeholder="Couleur"
                       PlaceholderColor="#555"
                       TextColor="Black" />

                <Entry x:Name="OriginEntry"
                       Placeholder="Origine"
                       PlaceholderColor="#555"
                       TextColor="Black" />

                <Label Text="Date de péremption :"
                       FontSize="14"
                       TextColor="Black" />
                <DatePicker x:Name="ExpirationDatePicker"
                            TextColor="Black" />

                <HorizontalStackLayout HorizontalOptions="Center" Spacing="15">
                    <Button Text="Enregistrer"
                            x:Name="SaveButton"
                            BackgroundColor="#2E86DE"
                            TextColor="White"
                            Clicked="OnSaveProductClicked" />
                    <Button Text="Annuler"
                            x:Name="CancelButton"
                            BackgroundColor="Gray"
                            TextColor="White"
                            Clicked="OnCancelClicked" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Frame>

        <!-- Liste des produits -->
        <CollectionView x:Name="StockCollectionView"
                        ItemsSource="{Binding StockItems}"
                        Margin="8"
                        SelectionMode="Single"
                        SelectionChanged="OnItemSelected">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="6" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Product">
                    <Border
                        Stroke="LightSlateGrey"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 12"
                        BackgroundColor="LightGray"
                        Padding="12"
                        Margin="8">

                        <Border.Shadow>
                            <Shadow Brush="Black"
                                    Offset="5,5"
                                    Radius="8"
                                    Opacity="0.25" />
                        </Border.Shadow>

                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                            <!-- Nom -->
                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Name}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="Black" />

                            <!-- Date de péremption -->
                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="{Binding ExpirationDate, StringFormat='Expires: {0:dd/MM/yyyy}'}"
                                   FontSize="14"
                                   TextColor="DarkRed" />

                            <!-- Couleur -->
                            <Label Grid.Row="2" Grid.Column="1"
                                   Text="{Binding Color}"
                                   HorizontalTextAlignment="End"
                                   FontSize="14"
                                   TextColor="Black" />

                            <!-- Origine -->
                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding Origin, StringFormat='ORG: {0}'}"
                                   HorizontalTextAlignment="End"
                                   FontSize="18"
                                   TextColor="Black"
                                   HorizontalOptions="End" />

                            <!-- Quantité -->
                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="{Binding Quantity, StringFormat='Qty: {0}'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="Blue" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>
