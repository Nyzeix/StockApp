<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="StockApp.Views.StockPage"
             xmlns:models="clr-namespace:StockApp.Models"
             Title="ðŸ“¦ Gestion du stock"
             BackgroundColor="#F7F8FA">

    <ScrollView>

        <VerticalStackLayout Padding="15" Spacing="15">

        <!-- Bouton Ajouter -->
        <Button Text="âž• Ajouter un produit"
                x:Name="AddButton"
                BackgroundColor="#0078D7"
                TextColor="White"
                FontAttributes="Bold"
                CornerRadius="10"
                HeightRequest="50"
                Clicked="OnAddButtonClicked" />

        <!-- Barre de recherche -->
        <SearchBar x:Name="ProductSearchBar"
                   Placeholder="Rechercher un produit..."
                   PlaceholderColor="#888"
                   FontSize="16"
                   HeightRequest="50"
                   TextChanged="OnSearchBarTextChanged"
                   BackgroundColor="White"
                   TextColor="Black"
                   Margin="0,5,0,0" />

        <!-- Ligne des filtres -->
        <HorizontalStackLayout Spacing="10" HorizontalOptions="FillAndExpand">
                <Picker x:Name="QuantitePicker"
                        Title="QuantitÃ©"
                        FontSize="16"
                        HorizontalOptions="FillAndExpand"
                        BackgroundColor="White"
                        TextColor="Black"
                        HeightRequest="65"/>

                <Picker x:Name="OriginPicker"
                    Title="Origine"
                    FontSize="16"
                    HorizontalOptions="FillAndExpand"
                    BackgroundColor="White"
                    TextColor="Black"
                    HeightRequest="65"  
                    ItemsSource="{Binding Origins}"
                    SelectedIndexChanged="OriginPicker_SelectedIndexChanged" />
        </HorizontalStackLayout>

        <!-- Formulaire dâ€™ajout -->
        <Border x:Name="AddProductForm"
               IsVisible="False"
               BackgroundColor="White"
               Padding="15"
               Margin="0,10,0,10">

            <VerticalStackLayout Spacing="10">
                <Label Text="Ajouter un produit"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#222"
                       HorizontalOptions="Center" />

                <!-- Nom -->
                <Border BackgroundColor="#F2F2F2" Padding="10" >
                    <Entry x:Name="NameEntry"
                           Placeholder="Nom du produit"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- QuantitÃ© -->
                <Border BackgroundColor="#F2F2F2" Padding="10" >
                    <Entry x:Name="QuantityEntry"
                           Placeholder="QuantitÃ©"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           Keyboard="Numeric"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- Couleur -->
                <Border BackgroundColor="#F2F2F2" Padding="10" >
                    <Entry x:Name="ColorEntry"
                           Placeholder="Couleur"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- Origine -->
                <Border BackgroundColor="#F2F2F2" Padding="10">
                    <Entry x:Name="OriginEntry"
                           Placeholder="Origine"
                           PlaceholderColor="#888"
                           TextColor="#111"
                           BackgroundColor="Transparent" />
                </Border>

                <!-- Date de pÃ©remption -->
                <Label Text="Date de pÃ©remption :" FontSize="14" TextColor="#444" />
                <Border BackgroundColor="#F2F2F2" Padding="5" >
                    <DatePicker x:Name="ExpirationDatePicker"
                                TextColor="#111"
                                BackgroundColor="Transparent" />
                </Border>

                <HorizontalStackLayout HorizontalOptions="Center" Spacing="15">
                    <Button Text="ðŸ’¾ Enregistrer"
                            x:Name="SaveButton"
                            BackgroundColor="#0078D7"
                            TextColor="White"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="45"
                            Clicked="OnSaveProductClicked" />
                    <Button Text="âŒ Annuler"
                            x:Name="CancelButton"
                            BackgroundColor="#AAAAAA"
                            TextColor="White"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="45"
                            Clicked="OnCancelClicked" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Liste des produits -->
        <CollectionView x:Name="StockCollectionView"
                        ItemsSource="{Binding StockItems}"
                        Margin="0,10,0,0"
                        SelectionMode="Single"
                        SelectionChanged="OnItemSelected">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10" />
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Product">
                    <Border BackgroundColor="White"
                           Padding="15">

                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Name}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#222" />

                            <Label Grid.Row="0" Grid.Column="1"
                                   Text="{Binding Origin, StringFormat='Origine : {0}'}"
                                   FontSize="16"
                                   HorizontalTextAlignment="End"
                                   TextColor="#555" />

                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="{Binding Quantity, StringFormat='QuantitÃ© : {0}'}"
                                   FontSize="16"
                                   TextColor="#0078D7" />

                            <Label Grid.Row="1" Grid.Column="1"
                                   Text="{Binding ExpirationDate, StringFormat='PÃ©remption : {0:dd/MM/yyyy}'}"
                                   FontSize="14"
                                   HorizontalTextAlignment="End"
                                   TextColor="#D9534F" />

                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="{Binding Color, StringFormat='Couleur : {0}'}"
                                   FontSize="14"
                                   TextColor="#666" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
